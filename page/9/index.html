<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/articles/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/articles/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/articles/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/articles/images/logo.svg" color="#222">

<link rel="stylesheet" href="/articles/css/main.css">


<link rel="stylesheet" href="/articles/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"tubetrue01.github.io","root":"/articles/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":"flat"},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":"gitalk","storage":true,"lazyload":false,"nav":null,"activeClass":"gitalk"},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="Tubetrue01">
<meta property="og:url" content="https://tubetrue01.github.io/page/9/">
<meta property="og:site_name" content="Tubetrue01">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Tubetrue01">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://tubetrue01.github.io/page/9/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Tubetrue01</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/articles/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Tubetrue01</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/articles/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/articles/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/articles/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://tubetrue01.github.io/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/articles/img/head.PNG">
      <meta itemprop="name" content="Tubetrue01">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Tubetrue01">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/articles/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/" class="post-title-link" itemprop="url">从 TreeMap 源码剖析红黑树（中）插入</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2023-03-09 19:08:17" itemprop="dateCreated datePublished" datetime="2023-03-09T19:08:17+08:00">2023-03-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-07-20 15:40:14" itemprop="dateModified" datetime="2023-07-20T15:40:14+08:00">2023-07-20</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><blockquote>
<p>上篇文章介绍了红黑树的性质，本篇文章将继续讲解红黑树的插入操作。</p>
</blockquote>
<h1 id="基本属性"><a href="#基本属性" class="headerlink" title="基本属性"></a>基本属性</h1><blockquote>
<p>这里我们先把红黑树的大体属性以 TreeMap 为原型列举出来。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RBTree</span>&lt;<span class="title">K</span> <span class="keyword">extends</span> <span class="title">Comparable</span>&lt;<span class="title">K</span>&gt;, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 红黑树的根节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Entry&lt;K, V&gt; root;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * 这里用 boolean 值代表红色或者黑色</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> RED   = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">boolean</span> BLACK = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 红黑树节点</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>, <span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">private</span> K k;</span><br><span class="line">        <span class="keyword">private</span> V v;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 红黑树节点是双向指针，这里指向当前节点的父节点</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Entry&lt;K,V&gt; parent;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 左节点</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Entry&lt;K,V&gt; left;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 右节点</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">private</span> Entry&lt;K,V&gt; right;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">         * 初始颜色为黑色</span></span><br><span class="line"><span class="comment">         */</span> </span><br><span class="line">        <span class="keyword">boolean</span> color = BLACK;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 添加一个构造器</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Entry</span><span class="params">(K k, V v, Entry&lt;K, V&gt; parent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.k = k;</span><br><span class="line">            <span class="keyword">this</span>.v = v;</span><br><span class="line">            <span class="keyword">this</span>.parent = parent;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 为当前 Entry 设置新值，并且返回老值</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> V <span class="title">setValue</span><span class="params">(V v)</span> </span>&#123;</span><br><span class="line">            V old = <span class="keyword">this</span>.v;</span><br><span class="line">            <span class="keyword">this</span>.v = v;</span><br><span class="line">            <span class="keyword">return</span> old;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前节点的父节点</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function">Entry&lt;K,V&gt; <span class="title">parentOf</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (p == <span class="keyword">null</span> ? <span class="keyword">null</span>: p.parent);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前节点的左子节点</span></span><br><span class="line"><span class="comment">     */</span> </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function">Entry&lt;K,V&gt; <span class="title">leftOf</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (p == <span class="keyword">null</span>) ? <span class="keyword">null</span>: p.left;</span><br><span class="line">    &#125;</span><br><span class="line">   </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前节点的右子节点</span></span><br><span class="line"><span class="comment">     */</span>  </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function">Entry&lt;K,V&gt; <span class="title">rightOf</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (p == <span class="keyword">null</span>) ? <span class="keyword">null</span>: p.right;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取当前节点的颜色，这里有一点需要注意，就是当 p 为 null 时，</span></span><br><span class="line"><span class="comment">     * 返回黑色，换句话说，黑色作为了一种判断节点为空的方式。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">colorOf</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">return</span> (p == <span class="keyword">null</span> ? BLACK : p.color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h1 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h1><h2 id="变色"><a href="#变色" class="headerlink" title="变色"></a>变色</h2><blockquote>
<p>节点的颜色由黑变红或者由红变黑。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 方法比较简单，就是将节点 p 设置成红色或者黑色（true：黑色，false：红色）</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;K,V&gt; <span class="function"><span class="keyword">void</span> <span class="title">setColor</span><span class="params">(Entry&lt;K,V&gt; p, <span class="keyword">boolean</span> c)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>)</span><br><span class="line">        p.color = c;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="左旋"><a href="#左旋" class="headerlink" title="左旋"></a>左旋</h2><blockquote>
<p>以某个节点作为旋转点，其右子节点变为旋转节点的父节点，右子节点的左子节点变为旋转节点的右子节点，左子节点保持不变。</p>
</blockquote>
<img src="/articles/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/01.jpg" class="" width="500">

<p>根据上图，我们看下左旋的代码实现：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以 p 为旋转点进行左旋</span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> *       5 (p)                 7</span></span><br><span class="line"><span class="comment"> *      / \                   / \</span></span><br><span class="line"><span class="comment"> * (l) 4   7 (r)   --&gt;       5   8</span></span><br><span class="line"><span class="comment"> *        / \               / \</span></span><br><span class="line"><span class="comment"> *       6   8             4   6</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(Entry&lt;K, V&gt; p)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">// 获取 p 的右节点</span></span><br><span class="line">        Entry&lt;K, V&gt; r = p.right;</span><br><span class="line">       </span><br><span class="line">        <span class="comment">// 将 p 的右节点指向 r 的左节点</span></span><br><span class="line">        p.right = r.left;</span><br><span class="line">        <span class="comment">// 因为是双向指针，所以要重新设置 r.left 的指向</span></span><br><span class="line">        <span class="keyword">if</span> (r.left != <span class="keyword">null</span>)</span><br><span class="line">            r.left.parent = p;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 将 r 的父节点指向 p 的父节点</span></span><br><span class="line">        r.parent = p.parent;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 如果 p 的父节点为 null，说明 p 是根节点，那么就将根节点指向 r </span></span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>) </span><br><span class="line">            root = r;</span><br><span class="line">        <span class="comment">// 如果 p 的父节点不为空，则需要判断 p 节点是其父节点的左节点还是右节点</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p)</span><br><span class="line">            p.parent.left = r;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            p.parent.right = r;</span><br><span class="line">        <span class="comment">// 将 r 的左节点指向 p</span></span><br><span class="line">        r.left = p;</span><br><span class="line">        <span class="comment">// 将 r 作为 p 的父节点</span></span><br><span class="line">        p.parent = r;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>整体逻辑比较清晰，唯一要注意的一点是，红黑树的各个节点之间是双向指针，在更改左右节点的同时还要更新其父节点的指向。</p>
<h2 id="右旋"><a href="#右旋" class="headerlink" title="右旋"></a>右旋</h2><blockquote>
<p>以某个节点作为旋转点，其左子节点变为旋转节点的父节点，左子节点的右子节点变为旋转节点的左子节点，右子节点保持不变。</p>
</blockquote>
<img src="/articles/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/02.jpg" class="" width="500">

<p>有了左旋的基础，我们在分析右旋就简单多了，只要把左旋中的方向左右兑换就行了。但是我们为了加深理解，还是在捋一遍吧！</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 以 p 为旋转点进行右旋</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *        7 (p)              5</span></span><br><span class="line"><span class="comment"> *       / \                / \</span></span><br><span class="line"><span class="comment"> * (l)  5   8 (r)   --&gt;    4   7</span></span><br><span class="line"><span class="comment"> *     / \                    / \</span></span><br><span class="line"><span class="comment"> *    4   6                  6   8</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateRight</span><span class="params">(Entry&lt;K, V&gt; p)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        Entry&lt;K, V&gt; l = p.left;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 将 l 的右节点挂载到 p 下</span></span><br><span class="line">        p.left = l.right;</span><br><span class="line">        <span class="keyword">if</span> (l.right != <span class="keyword">null</span>)</span><br><span class="line">            l.right.parent = p;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 更新 l 的父节点指向</span></span><br><span class="line">        l.parent = p.parent;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// p 为空，说明是根节点，将 l 更新为根节点</span></span><br><span class="line">        <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">            root = l;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p)</span><br><span class="line">            p.parent.left = l;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            p.parent.right = l;</span><br><span class="line">        </span><br><span class="line">        l.right = p;</span><br><span class="line">        p.parent = l;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="红黑树的插入"><a href="#红黑树的插入" class="headerlink" title="红黑树的插入"></a>红黑树的插入</h1><h2 id="2-3-4-树的插入"><a href="#2-3-4-树的插入" class="headerlink" title="2-3-4 树的插入"></a>2-3-4 树的插入</h2><blockquote>
<p>要想理解红黑树的插入，我们首先要明白 2-3-4 树的插入操作。</p>
</blockquote>
<p>2-3-4 树的插入一定是从叶子开始的，也就是说它是一棵自底向上增长的树。当叶子满足合并条件时，会进行合并。如果不满足条件时，中间的元素会向上增长。我们根据下图来回顾一下 2-3-4 树的增长过程：</p>
<img src="/articles/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/03.jpg" class="" width="600">

<p>还记得上篇文章中介绍的红黑树与 2-3-4 树的等价关系吗？我们搞懂了 2-3-4 树的插入逻辑，那么我们把红黑树的插入逻辑也以图例的形式展现出来（有一点需要特别注意，红黑树的插入节点都是红色的）：</p>
<img src="/articles/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/04.jpg" class="" width="600">

<p>只要我们记住红黑树与 2-3-4 树的等价关系，理解红黑树的插入就简单多了。</p>
<h2 id="元素插入"><a href="#元素插入" class="headerlink" title="元素插入"></a>元素插入</h2><blockquote>
<p>接下来，我们介绍插入的实现。此方法只是简单的将元素插入到指定的位置，对于树的调整，我们稍后介绍。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 我们将 4 作为带插入的元素</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * (t、p) 8               8              8            8          8</span></span><br><span class="line"><span class="comment"> *       / \             / \            / \          / \        / \</span></span><br><span class="line"><span class="comment"> *      5   12 -&gt; (t、p) 5   12   -&gt;   5   12  -&gt;   5   12  -&gt; 5   12</span></span><br><span class="line"><span class="comment"> *     / \              / \           / \          / \        / \</span></span><br><span class="line"><span class="comment"> *    3   6            3   6   (t、p) 3  6     (p) 3  6       3  6</span></span><br><span class="line"><span class="comment"> *                                                 \          \</span></span><br><span class="line"><span class="comment"> *                                             (t) null        4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 这里直接判断 key 是否为空，如果为 null 就抛出空指针异常。</span></span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line"></span><br><span class="line">    Entry&lt;K, V&gt; t = root;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果根节点为 null</span></span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 直接作为根节点</span></span><br><span class="line">        root = <span class="keyword">new</span> Entry&lt;&gt;(key, value, <span class="keyword">null</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 当根节点不为 null 时，就要添加节点了</span></span><br><span class="line">    <span class="keyword">int</span> cmp;</span><br><span class="line">    Entry&lt;K, V&gt; parent;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">do</span> &#123;</span><br><span class="line">        <span class="comment">// 先把 t 当前的值保留下来，因为在接下来遍历的过程中，t 可能为 null，此时 parent 就是待插入节点的父节点</span></span><br><span class="line">        parent = t;</span><br><span class="line">        <span class="comment">// 从根开始遍历，找到插入的目标位置节点</span></span><br><span class="line">        cmp = key.compareTo(t.k);</span><br><span class="line">        <span class="comment">// 如果待插入的节点比当前节点大</span></span><br><span class="line">        <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">            t = t.right;</span><br><span class="line">            <span class="comment">// 待插入的节点比当前节点小</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">            t = t.left;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="comment">// key 相等，则覆盖，并且返回旧值</span></span><br><span class="line">            <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">    &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建新的节点，并且将将该节点的父节点指向 parent</span></span><br><span class="line">    Entry&lt;K, V&gt; newEntry = <span class="keyword">new</span> Entry&lt;&gt;(key, value, parent);</span><br><span class="line">    <span class="comment">// 因为指针是双向的，这里要确定是 parent 的左孩子还是右孩子</span></span><br><span class="line">    <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">        parent.right = newEntry;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        parent.left = newEntry;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 元素插入之后，我们开始调整树的结构</span></span><br><span class="line">    fixAfterInsertion(newEntry);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>红黑树的插入操作就介绍完了，从代码上来看没有什么复杂性。而复杂的核心就在 <code>fixAfterInsertion(newEntry)</code> 方法了。不过不要着急，我们马上开始！</p>
<h2 id="红黑树的调整"><a href="#红黑树的调整" class="headerlink" title="红黑树的调整"></a>红黑树的调整</h2><blockquote>
<p>在讲代码之前，我们需要先弄清楚需要调整的场景，只有把逻辑捋顺了，看代码才不那么抽象。</p>
</blockquote>
<h3 id="3-节点调整"><a href="#3-节点调整" class="headerlink" title="3 节点调整"></a>3 节点调整</h3><img src="/articles/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/05.jpg" class="" width="500">

<h3 id="4-节点调整"><a href="#4-节点调整" class="headerlink" title="4 节点调整"></a>4 节点调整</h3><img src="/articles/2023/03/09/dsaa/%E4%BB%8ETreeMap%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%E7%BA%A2%E9%BB%91%E6%A0%91(%E4%B8%AD)%E6%8F%92%E5%85%A5/06.jpg" class="" width="500">

<p>了解了需要调整的场景之后，我们马上进入代码环节：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> x 为刚刚插入的元素，我们以它为基点进行树的调节，谁让它破坏了树的平衡呢</span></span><br><span class="line"><span class="comment"> *============================3 节点==================================</span></span><br><span class="line"><span class="comment"> *            3 (黑)     1 (黑)                  2 (黑)</span></span><br><span class="line"><span class="comment"> *           /            \                     / \</span></span><br><span class="line"><span class="comment"> *          2 (红)         2 (红)     -&gt;   (红) 1   3 (红)</span></span><br><span class="line"><span class="comment"> *         /                \</span></span><br><span class="line"><span class="comment"> *       *1 (红)            *3 (红)</span></span><br><span class="line"><span class="comment"> *--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> *     4 (黑)        4 (黑)            3 (黑)</span></span><br><span class="line"><span class="comment"> *    /             /                /  \</span></span><br><span class="line"><span class="comment"> *   2 (红)   -&gt;    3 (红)  -&gt;  (红) 2   4 (红)</span></span><br><span class="line"><span class="comment"> *    \            /</span></span><br><span class="line"><span class="comment"> *     *3 (红)     2 (红)</span></span><br><span class="line"><span class="comment"> *--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> *     3 (黑)           3 (黑)               4 (黑)</span></span><br><span class="line"><span class="comment"> *      \               \                  /  \</span></span><br><span class="line"><span class="comment"> *       5 (红)    -&gt;    4 (红)   -&gt;  (红) 3    5 (红)</span></span><br><span class="line"><span class="comment"> *       /               \</span></span><br><span class="line"><span class="comment"> *     *4 (红)            5 (红)</span></span><br><span class="line"><span class="comment"> *============================4 节点==================================</span></span><br><span class="line"><span class="comment"> *            2 (黑)                2 (红)              2 (黑)</span></span><br><span class="line"><span class="comment"> *           / \                   / \                 / \</span></span><br><span class="line"><span class="comment"> *      (红) 1  3 (红)    -&gt;  (黑) 1  3 (黑)   -&gt;  (黑) 1   3 (黑)</span></span><br><span class="line"><span class="comment"> *               \                   \                    \</span></span><br><span class="line"><span class="comment"> *               *4 (红)              4 (红)               4 (红)</span></span><br><span class="line"><span class="comment"> *--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> *            3 (黑)                3 (红)              3 (黑)</span></span><br><span class="line"><span class="comment"> *           / \                   / \                 / \</span></span><br><span class="line"><span class="comment"> *      (红) 1  5 (红)    -&gt;  (黑) 1  5 (黑)   -&gt;  (黑) 1   5 (黑)</span></span><br><span class="line"><span class="comment"> *              /                    /                    /</span></span><br><span class="line"><span class="comment"> *            *4 (红)                4 (红)               4 (红)</span></span><br><span class="line"><span class="comment"> *--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> *            5 (黑)              5 (红)                5 (黑)</span></span><br><span class="line"><span class="comment"> *           / \                 / \                  / \</span></span><br><span class="line"><span class="comment"> *     (红) 4   6 (红)  -&gt;  (黑) 4   6 (黑)   -&gt;  (黑) 4  6 (黑)</span></span><br><span class="line"><span class="comment"> *         /                   /                     /</span></span><br><span class="line"><span class="comment"> *   (红) *2              (红) 2                (红) 2</span></span><br><span class="line"><span class="comment"> *--------------------------------------------------------------------</span></span><br><span class="line"><span class="comment"> *            7 (黑)              7 (红)                7 (黑)</span></span><br><span class="line"><span class="comment"> *           / \                 / \                  / \</span></span><br><span class="line"><span class="comment"> *     (红) 4   8 (红)  -&gt;  (黑) 4   8 (黑)   -&gt;  (黑) 4  8 (黑)</span></span><br><span class="line"><span class="comment"> *          \                   /                    /</span></span><br><span class="line"><span class="comment"> *     (红) *5             (红) 5               (红) 5</span></span><br><span class="line"><span class="comment"> *====================================================================</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterInsertion</span><span class="params">(Entry&lt;K, V&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 新插入的元素都是红色</span></span><br><span class="line">    x.color = RED;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 只有当 x 不是 null，不是根节点以及为 x 的父节点为红色时才进行遍历调整。</span></span><br><span class="line"><span class="comment">     * 如果 x 为根，直接将颜色改为黑色即可；如果 x 的父节点颜色为红色时，说明出现了红色相连，此时才需要调整。其实此时只涉及</span></span><br><span class="line"><span class="comment">     * 了 3 节点以及 4 节点的场景。因为 2 节点可以直接合并，毕竟 2 节点时，</span></span><br><span class="line"><span class="comment">     * 它的父颜色是黑色。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123;</span><br><span class="line">        <span class="comment">// 如果是左倾树</span></span><br><span class="line">        <span class="keyword">if</span> (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123;</span><br><span class="line">            Entry&lt;K, V&gt; y = rightOf(parentOf(parentOf(x)));</span><br><span class="line">            <span class="comment">// 如果 x 的祖父节点存在右节点，说明当前是 4 节点，那么只需要变色就行了</span></span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                <span class="comment">// 将 x 的父节点、父的兄弟节点设置为黑色，祖父节点设置为红色</span></span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                setColor(y, BLACK);</span><br><span class="line">                <span class="comment">// 由于祖父节点被设置了红色，所以还要将祖父节点作为下一次迭代的基点进行调整</span></span><br><span class="line">                x = parentOf(parentOf(x));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// y 的颜色为黑色，说明 x 的祖父没有右节点，即：当前是 3 节点，那么就需要变色加旋转了</span></span><br><span class="line">                <span class="comment">// 在进行大的旋转之前，先判断是否需要进行小的旋转，也就是说是否 x 是作为右倾树出现的，那么先转换为左倾树</span></span><br><span class="line">                <span class="keyword">if</span> (x == rightOf(parentOf(x))) &#123;</span><br><span class="line">                    <span class="comment">// 旋转之后，x 会跟 x 的父调换位置，所以需要将父赋给 x，这样旋转之后，最底层的还是 x</span></span><br><span class="line">                    x = parentOf(x);</span><br><span class="line">                    rotateLeft(x);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// 3 节点，父变黑，祖父变红，然后以祖父为中心右旋</span></span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                rotateRight(parentOf(parentOf(x)));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 右倾树</span></span><br><span class="line">            <span class="comment">// 先拿到祖父的左节点，以此来判断是 3 节点还是 4 节点</span></span><br><span class="line">            Entry&lt;K, V&gt; y = leftOf(parentOf(parentOf(x)));</span><br><span class="line">            <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                <span class="comment">// 存在，说明是 4 节点，只需要单穿的染色就行了</span></span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                setColor(y, BLACK);</span><br><span class="line">                <span class="comment">// 既然祖父已经是红色了，那么肯定需要再以祖父为中心进行调整了，万一它的父节点也是红色的呢</span></span><br><span class="line">                x = parentOf(parentOf(x));</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">// 不用说，肯定是 3 节点了</span></span><br><span class="line">                <span class="comment">// 如果是左倾树，那么需要先旋转一次变成右倾树，因为整个子树是右倾的</span></span><br><span class="line">                <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">                    x = parentOf(x);</span><br><span class="line">                    rotateRight(x);</span><br><span class="line">                &#125;</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                rotateLeft(parentOf(parentOf(x)));</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 最后将根设置为黑色</span></span><br><span class="line">    root.color = BLACK;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据注释中的各种场景，在理解代码就简单很多了。</p>
<hr>
<h1 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h1><p>至此，红黑树的插入操作就介绍完了。整个插入过程还是比较简单的，通过迭代确定好插入的位置，然后进行指向。难点其实在于插入之后的平衡调节，相比 AVL 树，由于红黑树属于黑色平衡的弱平衡，其实只有在 3 节点的场景中才会涉及到旋转。4 节点的分裂也只是单纯的染色而已。另外需要注意的一点是，红黑树所有的插入节点一定是红色，同时节点之间是双向指针。在旋转变换时，一定要记得修改！</p>
<p>下一篇文章就是红黑树系列的最后一篇【删除】了，也是整个红黑树中最难的部分，不过不要紧，我还是以最简单的方式为大家呈现出来。好，我们下篇见！</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/articles/page/8/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/articles/">1</a><span class="space">&hellip;</span><a class="page-number" href="/articles/page/8/">8</a><span class="page-number current">9</span><a class="page-number" href="/articles/page/10/">10</a><span class="space">&hellip;</span><a class="page-number" href="/articles/page/68/">68</a><a class="extend next" rel="next" href="/articles/page/10/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Tubetrue01"
      src="/articles/img/head.PNG">
  <p class="site-author-name" itemprop="name">Tubetrue01</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/articles/archives/">
        
          <span class="site-state-item-count">68</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/articles/tags/">
          
        <span class="site-state-item-count">24</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/Tubetrue01" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Tubetrue01" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="/articles/Tubetrue01@gmail.com" title="E-Mail → Tubetrue01@gmail.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Tubetrue01</span>
</div>



        
<div class="busuanzi-count">
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/articles/lib/anime.min.js"></script>
  <script src="//cdn.jsdelivr.net/gh/theme-next/theme-next-pjax@0/pjax.min.js"></script>
  <script src="/articles/lib/velocity/velocity.min.js"></script>
  <script src="/articles/lib/velocity/velocity.ui.min.js"></script>

<script src="/articles/js/utils.js"></script>

<script src="/articles/js/motion.js"></script>


<script src="/articles/js/schemes/pisces.js"></script>


<script src="/articles/js/next-boot.js"></script>

  <script>
var pjax = new Pjax({
  selectors: [
    'head title',
    '#page-configurations',
    '.content-wrap',
    '.post-toc-wrap',
    '.languages',
    '#pjax'
  ],
  switches: {
    '.post-toc-wrap': Pjax.switches.innerHTML
  },
  analytics: false,
  cacheBust: false,
  scrollTo : !CONFIG.bookmark.enable
});

window.addEventListener('pjax:success', () => {
  document.querySelectorAll('script[data-pjax], script#page-configurations, #pjax script').forEach(element => {
    var code = element.text || element.textContent || element.innerHTML || '';
    var parent = element.parentNode;
    parent.removeChild(element);
    var script = document.createElement('script');
    if (element.id) {
      script.id = element.id;
    }
    if (element.className) {
      script.className = element.className;
    }
    if (element.type) {
      script.type = element.type;
    }
    if (element.src) {
      script.src = element.src;
      // Force synchronous loading of peripheral JS.
      script.async = false;
    }
    if (element.dataset.pjax !== undefined) {
      script.dataset.pjax = '';
    }
    if (code !== '') {
      script.appendChild(document.createTextNode(code));
    }
    parent.appendChild(script);
  });
  NexT.boot.refresh();
  // Define Motion Sequence & Bootstrap Motion.
  if (CONFIG.motion.enable) {
    NexT.motion.integrator
      .init()
      .add(NexT.motion.middleWares.subMenu)
      .add(NexT.motion.middleWares.postList)
      .bootstrap();
  }
  NexT.utils.updateSidebarPosition();
});
</script>




  















    <div id="pjax">
  

  


    </div>
</body>
</html>
